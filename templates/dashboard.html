{% extends 'base.html' %}
{% block title %}Dashboard - Professional Accounting System{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        color: white;
        padding: 2rem 0;
        margin: -2rem -2rem 2rem -2rem;
        border-radius: 0 0 1rem 1rem;
    }
    
    .metric-card {
        background: white;
        border: none;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
    }
    
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.2);
    }
    
    .metric-icon {
        width: 3rem;
        height: 3rem;
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin-bottom: 1rem;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        color: #6b7280;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    .metric-change {
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .metric-change.positive {
        color: #10b981;
    }
    
    .metric-change.neutral {
        color: #6b7280;
    }
    
    .quick-actions {
        background: #f8fafc;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .action-btn {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        text-decoration: none;
        color: #374151;
        display: flex;
        align-items: center;
        transition: all 0.2s ease;
        margin-bottom: 0.75rem;
    }
    
    .action-btn:hover {
        background: #2563eb;
        color: white;
        border-color: #2563eb;
        transform: translateX(5px);
    }
    
    .action-icon {
        width: 2.5rem;
        height: 2.5rem;
        background: #f3f4f6;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        transition: background 0.2s ease;
    }
    
    .action-btn:hover .action-icon {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .recent-activity {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
    }
    
    .activity-item {
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        align-items: center;
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-icon {
        width: 2rem;
        height: 2rem;
        background: #e5e7eb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
        font-size: 0.8rem;
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-time {
        color: #6b7280;
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 mb-1 fw-bold">Welcome back, {{ user.first_name|default:user.username }}!</h1>
                <p class="mb-0 opacity-75">Here's what's happening with your business today</p>
            </div>
            <div>
                <button class="btn btn-light">
                    <i class="bi bi-upload me-2"></i>
                    Upload Bank Statement
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <h5 class="mb-3 fw-bold text-dark">
        <i class="bi bi-lightning-charge me-2 text-primary"></i>
        Quick Actions
    </h5>
    <div class="row g-3">
        <div class="col-lg-3 col-md-6">
            <a href="/journal/" class="action-btn">
                <div class="action-icon">
                    <i class="bi bi-journal-text"></i>
                </div>
                <div>
                    <div class="fw-semibold">Record Journal Entry</div>
                    <small class="text-muted">Add manual transactions</small>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="/reconciliation/" class="action-btn">
                <div class="action-icon">
                    <i class="bi bi-arrow-repeat"></i>
                </div>
                <div>
                    <div class="fw-semibold">Bank Reconciliation</div>
                    <small class="text-muted">Match transactions</small>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="/reports/" class="action-btn">
                <div class="action-icon">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <div>
                    <div class="fw-semibold">Generate Reports</div>
                    <small class="text-muted">Financial statements</small>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="/assets/" class="action-btn">
                <div class="action-icon">
                    <i class="bi bi-building"></i>
                </div>
                <div>
                    <div class="fw-semibold">Manage Assets</div>
                    <small class="text-muted">Track fixed assets</small>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Key Metrics -->
<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="card metric-card text-center">
            <div class="card-body">
                <div class="metric-icon mx-auto">
                    <i class="bi bi-bank"></i>
                </div>
                <div class="metric-value">$45,250</div>
                <div class="metric-label">Total Cash Balance</div>
                <div class="metric-change positive">
                    <i class="bi bi-arrow-up"></i> +$2,340 this month
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card metric-card text-center">
            <div class="card-body">
                <div class="metric-icon mx-auto">
                    <i class="bi bi-journal-check"></i>
                </div>
                <div class="metric-value">147</div>
                <div class="metric-label">Journal Entries</div>
                <div class="metric-change positive">
                    <i class="bi bi-arrow-up"></i> 12 this week
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card metric-card text-center">
            <div class="card-body">
                <div class="metric-icon mx-auto">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="metric-value">98%</div>
                <div class="metric-label">Reconciliation Rate</div>
                <div class="metric-change neutral">
                    <i class="bi bi-dash"></i> 3 pending items
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="card metric-card text-center">
            <div class="card-body">
                <div class="metric-icon mx-auto">
                    <i class="bi bi-building-gear"></i>
                </div>
                <div class="metric-value">24</div>
                <div class="metric-label">Fixed Assets</div>
                <div class="metric-change neutral">
                    <i class="bi bi-dash"></i> $156k total value
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Recent Activity -->
    <div class="col-lg-8">
        <div class="recent-activity">
            <h5 class="mb-3 fw-bold text-dark">
                <i class="bi bi-clock-history me-2 text-primary"></i>
                Recent Activity
            </h5>
            
            <div class="activity-item">
                <div class="activity-icon bg-success text-white">
                    <i class="bi bi-plus"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Journal Entry #JE-2024-147</div>
                    <small class="text-muted">Office Supplies Expense - $245.00</small>
                </div>
                <div class="activity-time">2 hours ago</div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon bg-primary text-white">
                    <i class="bi bi-arrow-repeat"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Bank Reconciliation</div>
                    <small class="text-muted">Matched 15 transactions for Chase Checking</small>
                </div>
                <div class="activity-time">4 hours ago</div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon bg-warning text-white">
                    <i class="bi bi-building"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Asset Depreciation</div>
                    <small class="text-muted">Calculated monthly depreciation - $1,240.00</small>
                </div>
                <div class="activity-time">1 day ago</div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon bg-info text-white">
                    <i class="bi bi-file-text"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Trial Balance Report</div>
                    <small class="text-muted">Generated monthly trial balance report</small>
                </div>
                <div class="activity-time">2 days ago</div>
            </div>
            
            <div class="text-center mt-3">
                <a href="#" class="btn btn-outline-primary btn-sm">View All Activity</a>
            </div>
        </div>
    </div>
    
    <!-- Pending Tasks -->
    <div class="col-lg-4">
        <div class="recent-activity">
            <h5 class="mb-3 fw-bold text-dark">
                <i class="bi bi-list-task me-2 text-primary"></i>
                Pending Tasks
            </h5>
            
            <div class="activity-item">
                <div class="activity-icon bg-warning text-white">
                    <i class="bi bi-exclamation"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">3 Unmatched Transactions</div>
                    <small class="text-muted">Bank reconciliation pending</small>
                </div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon bg-danger text-white">
                    <i class="bi bi-calendar-x"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Month-End Close</div>
                    <small class="text-muted">Due in 5 days</small>
                </div>
            </div>
            
            <div class="activity-item">
                <div class="activity-icon bg-secondary text-white">
                    <i class="bi bi-upload"></i>
                </div>
                <div class="activity-content">
                    <div class="fw-semibold">Upload Bank Statements</div>
                    <small class="text-muted">2 accounts pending</small>
                </div>
            </div>
            
            <div class="text-center mt-3">
                <a href="#" class="btn btn-outline-primary btn-sm">View All Tasks</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
          <i class="fas fa-check-circle fa-2x"></i>
        </div>
        <h3 class="h4 mb-1 text-navy">1,247</h3>
        <p class="text-muted mb-0 small">Transactions Assigned</p>
        <p class="text-success mb-0 small">
          <i class="fas fa-arrow-up me-1"></i>89% completion
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-warning mb-2">
          <i class="fas fa-clock fa-2x"></i>
        </div>
        <h3 class="h4 mb-1 text-navy">23</h3>
        <p class="text-muted mb-0 small">Pending Assignment</p>
        <p class="text-warning mb-0 small">
          <i class="fas fa-exclamation-triangle me-1"></i>Needs attention
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="text-info mb-2">
          <i class="fas fa-balance-scale fa-2x"></i>
        </div>
        <h3 class="h4 mb-1 text-navy amount">$124,567.89</h3>
        <p class="text-muted mb-0 small">Current Balance</p>
        <p class="text-success mb-0 small">
          <i class="fas fa-check me-1"></i>Balanced
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Main Action Cards -->
<div class="row mb-4">
  <!-- Reconciliation Module -->
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center">
        <i class="fas fa-sync text-primary me-2"></i>
        <h5 class="mb-0">Bank Reconciliation</h5>
      </div>
      <div class="card-body">
        <p class="text-muted mb-3">
          Upload bank statements and assign transactions to GL accounts.
        </p>
        <div class="mb-3">
          <div class="d-flex justify-content-between mb-1">
            <small>This Month Progress</small>
            <small class="text-muted">89%</small>
          </div>
          <div class="progress" style="height: 6px">
            <div class="progress-bar bg-success" style="width: 89%"></div>
          </div>
        </div>
        <div class="d-grid gap-2">
          <a
            href="{% url 'reconciliation:upload' %}"
            class="btn btn-primary btn-sm"
          >
            <i class="fas fa-upload me-1"></i> Upload Statement
          </a>
          <a
            href="{% url 'reconciliation:file_list' %}"
            class="btn btn-outline-secondary btn-sm"
          >
            <i class="fas fa-list me-1"></i> View Files
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart of Accounts -->
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center">
        <i class="fas fa-list text-success me-2"></i>
        <h5 class="mb-0">Chart of Accounts</h5>
      </div>
      <div class="card-body">
        <p class="text-muted mb-3">
          Manage your general ledger accounts and categories.
        </p>
        <div class="mb-3">
          <div class="row text-center">
            <div class="col-6">
              <div class="text-navy fw-bold">156</div>
              <small class="text-muted">Total Accounts</small>
            </div>
            <div class="col-6">
              <div class="text-navy fw-bold">12</div>
              <small class="text-muted">Bank Accounts</small>
            </div>
          </div>
        </div>
        <div class="d-grid gap-2">
          <a href="{% url 'coa:chart_list' %}" class="btn btn-success btn-sm">
            <i class="fas fa-eye me-1"></i> View Chart
          </a>
          <a
            href="{% url 'coa:create_account' %}"
            class="btn btn-outline-secondary btn-sm"
          >
            <i class="fas fa-plus me-1"></i> Add Account
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Manual Journal -->
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center">
        <i class="fas fa-edit text-warning me-2"></i>
        <h5 class="mb-0">Manual Journal</h5>
      </div>
      <div class="card-body">
        <p class="text-muted mb-3">
          Create and manage manual journal entries with approval workflow.
        </p>
        <div class="mb-3">
          <div class="d-flex justify-content-between mb-2">
            <span class="badge bg-info">5 Draft</span>
            <span class="badge bg-warning">2 Pending</span>
            <span class="badge bg-success">18 Posted</span>
          </div>
        </div>
        <div class="d-grid gap-2">
          <a href="#" class="btn btn-warning btn-sm">
            <i class="fas fa-plus me-1"></i> Create Entry
          </a>
          <a href="#" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-list me-1"></i> View Entries
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reports Section -->
<div class="row mb-4">
  <div class="col-md-6">
    <div class="card">
      <div
        class="card-header d-flex align-items-center justify-content-between"
      >
        <h5 class="mb-0">
          <i class="fas fa-chart-bar me-2"></i>Financial Reports
        </h5>
        <a href="#" class="btn btn-outline-primary btn-sm">View All</a>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          <a
            href="#"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div>
              <i class="fas fa-balance-scale me-2"></i>Trial Balance
              <small class="text-muted d-block"
                >Current period balance verification</small
              >
            </div>
            <span class="badge bg-success">Updated</span>
          </a>
          <a
            href="#"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div>
              <i class="fas fa-chart-line me-2"></i>Profit & Loss
              <small class="text-muted d-block"
                >January 2025 P&L statement</small
              >
            </div>
            <span class="badge bg-warning">Draft</span>
          </a>
          <a
            href="#"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div>
              <i class="fas fa-clipboard-list me-2"></i>Balance Sheet
              <small class="text-muted d-block">As of January 31, 2025</small>
            </div>
            <span class="badge bg-info">Preview</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="col-md-6">
    <div class="card">
      <div
        class="card-header d-flex align-items-center justify-content-between"
      >
        <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Recent Activity</h5>
        <small class="text-muted">Last 24 hours</small>
      </div>
      <div class="card-body">
        <div class="timeline">
          <div class="timeline-item mb-3">
            <div class="d-flex">
              <div class="flex-shrink-0 me-3">
                <div
                  class="bg-success rounded-circle d-flex align-items-center justify-content-center"
                  style="width: 32px; height: 32px"
                >
                  <i class="fas fa-upload text-white small"></i>
                </div>
              </div>
              <div class="flex-grow-1">
                <div class="small fw-bold">Bank statement uploaded</div>
                <div class="small text-muted">
                  January_2025_Statement.csv - 156 transactions
                </div>
                <div class="small text-muted">2 hours ago</div>
              </div>
            </div>
          </div>

          <div class="timeline-item mb-3">
            <div class="d-flex">
              <div class="flex-shrink-0 me-3">
                <div
                  class="bg-primary rounded-circle d-flex align-items-center justify-content-center"
                  style="width: 32px; height: 32px"
                >
                  <i class="fas fa-check text-white small"></i>
                </div>
              </div>
              <div class="flex-grow-1">
                <div class="small fw-bold">45 transactions assigned</div>
                <div class="small text-muted">
                  Manual GL account assignment completed
                </div>
                <div class="small text-muted">4 hours ago</div>
              </div>
            </div>
          </div>

          <div class="timeline-item">
            <div class="d-flex">
              <div class="flex-shrink-0 me-3">
                <div
                  class="bg-warning rounded-circle d-flex align-items-center justify-content-center"
                  style="width: 32px; height: 32px"
                >
                  <i class="fas fa-edit text-white small"></i>
                </div>
              </div>
              <div class="flex-grow-1">
                <div class="small fw-bold">Journal entry created</div>
                <div class="small text-muted">JE-2025-001 pending approval</div>
                <div class="small text-muted">Yesterday</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% else %}
<!-- Non-authenticated user content -->
<div class="container-fluid py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
            <div class="mb-5">
                <h1 class="display-4 fw-bold text-navy mb-3">Professional Accounting System</h1>
                <p class="lead text-muted mb-4">Streamline your business finances with our comprehensive accounting solution</p>
                <div class="d-flex gap-3 justify-content-center">
                    <a href="{% url 'users:login' %}" class="btn btn-primary btn-lg px-4">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        Sign In
                    </a>
                    <a href="{% url 'users:register' %}" class="btn btn-outline-primary btn-lg px-4">
                        <i class="bi bi-person-plus me-2"></i>
                        Create Account
                    </a>
                </div>
            </div>
            
            <div class="row g-4 mt-5">
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 4rem; height: 4rem;">
                            <i class="bi bi-list-task text-primary fs-4"></i>
                        </div>
                        <h5 class="mt-3">Chart of Accounts</h5>
                        <p class="text-muted">Organize your business accounts with professional hierarchy</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 4rem; height: 4rem;">
                            <i class="bi bi-arrow-repeat text-primary fs-4"></i>
                        </div>
                        <h5 class="mt-3">Bank Reconciliation</h5>
                        <p class="text-muted">Match transactions and maintain accurate cash records</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 4rem; height: 4rem;">
                            <i class="bi bi-file-earmark-text text-primary fs-4"></i>
                        </div>
                        <h5 class="mt-3">Financial Reports</h5>
                        <p class="text-muted">Generate professional reports for business insights</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
